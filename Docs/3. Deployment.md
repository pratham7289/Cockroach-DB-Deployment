# CockroachDB Cluster on RHEL 9.6 with k3s

This guide describes how to deploy a **3-pod CockroachDB cluster** on a **RHEL 9.6** virtual machine (3 vCPUs, 8GB RAM) using **k3s**, a lightweight Kubernetes distribution.

---

## ðŸ§° Prerequisites

- RHEL 9.6 virtual machine (3 vCPUs, 8GB RAM)
- Root/sudo privileges
- Internet access
- Basic familiarity with Kubernetes

---

## ðŸš€ Deployment Steps

### 1. Update the System


sudo dnf update -y
2. Install Required Tools
bash
Copy
Edit
sudo dnf install -y curl
3. Check SELinux Status
bash
Copy
Edit
sestatus
If SELinux is in Enforcing mode and you face issues, consider switching to Permissive during testing.

4. Install k3s
bash
Copy
Edit
curl -sfL https://get.k3s.io | sh -
This sets up a single-node k3s Kubernetes cluster.

5. Verify k3s is Running
bash
Copy
Edit
sudo systemctl status k3s
kubectl get nodes
Ensure the node is in a Ready state.

6. Configure kubectl for Non-root Use
bash
Copy
Edit
mkdir -p $HOME/.kube
sudo cp /etc/rancher/k3s/k3s.yaml $HOME/.kube/config
sudo chown $USER:$USER $HOME/.kube/config
echo 'export KUBECONFIG=$HOME/.kube/config' >> ~/.bashrc
source ~/.bashrc
7. Configure Firewall for Cluster Communication
bash
Copy
Edit
sudo firewall-cmd --permanent --add-port=6443/tcp        # Kubernetes API
sudo firewall-cmd --permanent --add-port=26257/tcp       # CockroachDB SQL
sudo firewall-cmd --permanent --add-port=26258/tcp       # CockroachDB Inter-node
sudo firewall-cmd --permanent --add-port=8080/tcp        # Admin UI
sudo firewall-cmd --permanent --add-source=10.42.0.0/16  # k3s CNI range
sudo firewall-cmd --permanent --zone=public --add-source=192.168.0.0/24  # Example LAN range
sudo firewall-cmd --reload
Adjust IP ranges based on your actual network setup.

8. Deploy the CockroachDB Operator
bash
Copy
Edit
curl -s https://raw.githubusercontent.com/cockroachdb/cockroach-operator/v2.12.0/install/crds.yaml -o crds.yaml
kubectl apply -f crds.yaml

curl -s https://raw.githubusercontent.com/cockroachdb/cockroach-operator/v2.12.0/install/operator.yaml -o operator.yaml
kubectl apply -f operator.yaml
9. Verify the Operator is Running
bash
Copy
Edit
kubectl get pods -n cockroach-operator-system
Ensure the Operator pod is in the Running state.

10. Create a Namespace for CockroachDB
bash
Copy
Edit
kubectl create namespace cockroachdb
11. Deploy the CockroachDB Cluster
bash
Copy
Edit
kubectl apply -f manifests/cockroachdb-cluster.yaml
Make sure the cockroachdb-cluster.yaml file exists in manifests/ and defines a 3-node cluster.

12. Verify Cluster and Access Admin UI
bash
Copy
Edit
kubectl get pods -n cockroachdb

kubectl port-forward svc/cockroachdb-public -n cockroachdb 8080:8080
Open http://localhost:8080 to access the CockroachDB Admin UI.

```bash
