# CockroachDB Load Balancing Test

This guide validates **CockroachDB‚Äôs load balancing** by inserting 1,010,000 rows and checking range distribution across a 3-pod cluster.

---

## üß™ Test Plan

### 1Ô∏è‚É£ Set Up Database and Table

```bash
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach sql --insecure -e "CREATE DATABASE IF NOT EXISTS bank;"
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach sql --insecure -e "CREATE TABLE IF NOT EXISTS bank.accounts (id INT PRIMARY KEY, balance DECIMAL);"
```

‚úÖ Prepares the test schema.

---

### 2Ô∏è‚É£ Insert Initial Data (10,000 Rows)

```bash
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach sql --insecure -e "
BEGIN;
INSERT INTO bank.accounts (id, balance)
SELECT generate_series AS id, (random() * 10000)::DECIMAL(10,2) AS balance
FROM generate_series(1, 10000);
COMMIT;"
```

‚úÖ Inserts moderate data to verify functionality.

---

### 3Ô∏è‚É£ Insert Large Dataset (1,000,000 Rows)

```bash
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach sql --insecure -e "
BEGIN;
INSERT INTO bank.accounts (id, balance)
SELECT generate_series + 10000 AS id, (random() * 10000)::DECIMAL(10,2) AS balance
FROM generate_series(1, 1000000);
COMMIT;"
```

‚úÖ Simulates a production-scale workload.

---

### 4Ô∏è‚É£ Verify Data

```bash
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach sql --insecure -e "SELECT count(*) FROM bank.accounts;"
```

‚úÖ Confirms **1,010,000 rows** were inserted.

---

### 5Ô∏è‚É£ Check Node Health

```bash
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach node status --insecure
```

‚úÖ Ensures all nodes are live and reachable.

---

### 6Ô∏è‚É£ Verify Load Distribution

```bash
kubectl exec -it cockroachdb-0 -n cockroachdb -- ./cockroach sql --insecure -e "SELECT lease_holder, count(*) FROM crdb_internal.ranges GROUP BY lease_holder;"
```

‚úÖ Verifies a **balanced leaseholder distribution** (e.g., 29, 21, 25 ranges across nodes 1, 2, 3).

---

## ‚úÖ Results Summary

| Check              | Result                                      |
|--------------------|---------------------------------------------|
| Data Inserted      | **1,010,000 rows** successfully inserted     |
| Node Health        | All nodes live and available                |
| Load Distribution  | Leases balanced across nodes (e.g., 29/21/25) |
